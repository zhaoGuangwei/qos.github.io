(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{372:function(t,e,a){"use strict";a.r(e);var s=a(42),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"abci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abci"}},[t._v("#")]),t._v(" ABCI")]),t._v(" "),a("h2",{attrs:{id:"endblocker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#endblocker"}},[t._v("#")]),t._v(" EndBlocker")]),t._v(" "),a("p",[t._v("The end of each block will check the invariant-check flag, query the lock-info and release locked QOS.")]),t._v(" "),a("h3",{attrs:{id:"invariant-check"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#invariant-check"}},[t._v("#")]),t._v(" Invariant Check")]),t._v(" "),a("p",[t._v("Add an 'EventTypeInvariantCheck` event when there is a invariant check request:")]),t._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NeedInvariantCheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("EventManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("EmitEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("btypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qtypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventTypeInvariantCheck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("In")]),t._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("QOSApp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("EndBlocker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req abci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RequestEndBlock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" abci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseEndBlock "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("checking whether there is a invariant check event to perform a network-wide data check.")]),t._v(" "),a("h3",{attrs:{id:"lock-release"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lock-release"}},[t._v("#")]),t._v(" Lock-Release")]),t._v(" "),a("p",[t._v("If it exists "),a("RouterLink",{attrs:{to:"/en/spec/bank/2_state.html#lockinfo"}},[t._v("LockInfo")]),t._v(", the release time is reached, a release operation will performed.")],1),t._v(" "),a("p",[t._v("First, calculate release amount in this time")]),t._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ReleaseTimes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    releaseAmount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TotalAmount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ReleasedAmount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" ReleaseTimes\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    releaseAmount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TotalAmount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ReleasedAmount\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("then")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("LockedAccount")]),t._v(" minus "),a("code",[t._v("releaseAmount")])]),t._v(" "),a("li",[a("code",[t._v("Receiver")]),t._v(" plus  "),a("code",[t._v("releaseAmount")])]),t._v(" "),a("li",[a("code",[t._v("ReleasedAmount")]),t._v(" plus "),a("code",[t._v("releaseAmount")])]),t._v(" "),a("li",[a("code",[t._v("ReleaseTimes")]),t._v(" = "),a("code",[t._v("ReleaseTimes - 1")])]),t._v(" "),a("li",[a("code",[t._v("ReleaseTime")]),t._v(" = "),a("code",[t._v("ReleaseTime + ReleaseInterval")])])]),t._v(" "),a("p",[t._v("If the lock-release is all completed, the lock-release record is deleted.")])])}),[],!1,null,null,null);e.default=n.exports}}]);